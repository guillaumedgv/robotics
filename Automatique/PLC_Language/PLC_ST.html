<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Structured Text</title>
  <link rel="stylesheet" href="../../style.css">
</head>
<body>

  <!-- Navbar dynamique -->
  <div id="navbar"></div>

  <!-- --- MathJax for LaTeX equations --- -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>

  <script>
  // Load navbar dynamically from external file
  fetch("navbar_plc_language.html")
    .then(response => response.text())  // Read the content as text
    .then(data => {
      // Insert the navbar HTML into the page
      document.getElementById("navbar").innerHTML = data;

      // ----------------------------
      // Highlight the current page
      // ----------------------------
      const currentPath = window.location.pathname;  // e.g., "/index.html"
      const links = document.querySelectorAll("#navbar nav a"); // all nav links

      links.forEach(link => {
        const href = link.getAttribute("href");
        if (!href) return; // Skip links without href

        // Normalize paths (remove leading slash) to compare properly
        const normalizedHref = href.replace(/^\//, "");
        const normalizedPath = currentPath.replace(/^\//, "");

        if (normalizedPath.endsWith(normalizedHref)) {
          // ‚úÖ Mark link of current page as active
          link.classList.add("active");

          // If the link is in a submenu, also highlight its parent
          const parentLi = link.closest("ul")?.closest("li");
          if (parentLi) {
            const parentLink = parentLi.querySelector(":scope > a");
            if (parentLink) parentLink.classList.add("active-parent");
          }
        } else {
          // Remove active class from other links
          link.classList.remove("active");
        }
      });

      // ----------------------------
      // Night mode toggle button
      // ----------------------------
      const themeToggle = document.getElementById("themeToggle");

      // On page load, check if user previously enabled night mode
      if (localStorage.getItem("nightMode") === "true") {
        document.body.classList.add("night");
        if (themeToggle) themeToggle.textContent = "‚òÄÔ∏è Day Mode";
      }

      // Set up click listener for the button
      if (themeToggle) {
        themeToggle.addEventListener("click", () => {
          document.body.classList.toggle("night"); // Toggle night mode

          // Save current mode in localStorage to persist across pages
          const isNight = document.body.classList.contains("night");
          localStorage.setItem("nightMode", isNight);

          // Update button text based on current mode
          themeToggle.textContent = isNight ? "‚òÄÔ∏è Day Mode" : "üåô Night Mode";
        });
      }
    })
    .catch(error => console.error("Erreur chargement navbar :", error));
</script>


<div class="container">
    <!-- Contenu principal -->
    <aside class="sidebar">
      <h3>PLC - Language de Programmation</h3>
      <ul>
        <li><a href="PLC_ST.html" class="active">Structured Text (ST)</a></li>
        <li><a href="PLC_Ladder.html">Ladder (LD)</a></li>
        <li><a href="PLC_SFC.html">Graphcet (SFC)</a></li>
      </ul>
    </aside> 

    <main class="content">

        <h1>Quand, O√π, Pourquoi ?</h1>

        <p>
        Le <strong>Structured Text (ST)</strong> est utilis√© lorsque l‚Äôautomatisme n√©cessite
        une logique difficile √† repr√©senter graphiquement.
        Contrairement au Ladder ou au Graphcet, il permet d‚Äô√©crire des instructions
        sous forme de code structur√©, proche des langages de programmation classiques
        comme le Pascal ou le C.
        </p>

        <p>
        On utilise le Structured Text principalement 
        lorsque l‚Äôapplication implique des op√©rations math√©matiques, des boucles,
        des conditions imbriqu√©es ou la gestion de recettes et de param√®tres.
        Il est tr√®s r√©pandu dans les syst√®mes de r√©gulation, les machines complexes
        et les applications n√©cessitant une grande flexibilit√© logicielle.
        </p>

        <hr>

        <h1>Donnees</h1>

        <h3>Nombres</h3>
        <p>
        Types num√©riques pour variables et constantes : 
        <ul>
            <li><b>SINT</b> (8 bits : -128 √† 127), <br></li>
            <li><b>USINT</b> (8 bits : 0 √† 255), <br></li>
            <li><b>INT</b> (16 bits : -32 768 √† 32 767), <br></li>
            <li><b>UINT</b> (16 bits : 0 √† \(2^{16}-1\)), <br></li>
            <li><b>DINT</b> (32 bits : - \(2^{31}\) √† \(2^{31}-1\)), <br></li>
            <li><b>LINT</b> (64 bits : - \(2^{63}\) √† \(2^{63}-1\)), <br></li>
            <li><b>REAL</b> (32 bits flottant, - \(10^{38}\) √† \(10^{38}\)), <br></li>
        </ul>
        </p>
        <p>
        Pour chaque type, on peut d√©finir une <b>limite inf√©rieure (MIN)</b> et une <b>limite sup√©rieure (MAX)</b> :  
        \[
        \text{MIN} \leq \text{variable} \leq \text{MAX}
        \]  
        </p>
        <p>
        Le r√©sultat d‚Äôune op√©ration doit rester dans ces limites, sinon il y a un <b>overflow</b> ou <b>underflow</b>.
        </p>

        <h3>Temps</h3>
        <p>
        Types : <b>TIME</b>, <b>DATE</b>, <b>TOD (Time of Day)</b>, <b>DATE_AND_TIME (DT)</b>.  
        Chaque type poss√®de un intervalle valide et retourne diff√©rentes informations :
        <ul>
            <li>
                <b>TIME</b> : dur√©e exprim√©e en millisecondes.  
                Exemples de litt√©raux ST :  
                <em>t#50ms</em> (50 millisecondes), <em>t#5s</em> (5 secondes), <em>t#2m</em> (2 minutes)
            </li>
            <li>
                <b>DATE</b> : jour/mois/ann√©e.  
                On peut initialiser une variable avec un litt√©ral :  
                <em>d#2025-12-25</em> correspond au 25 d√©cembre 2025
            </li>
            <li>
                <b>TOD</b> (Time of Day) : heure du jour.  
                Exemple ST : <em>tod#14:35:20</em> ou avec millisecondes <em>tod#14:35:20.500</em>
            </li>
            <li>
                <b>DATE_AND_TIME</b> : combinaison date + heure + millisecondes.  
                Exemple ST : <em>dt#2025-12-25-14:35:20.500</em>
            </li>
        </ul>
        </ul>
        </p>

        <h3>Mots et cha√Ænes</h3>
        <p>
        <b>STRING</b> : texte avec longueur maximale d√©finie, ex. <em>STRING[80]</em> pour 80 caract√®res.  <br>
        <b>BIT, BYTE, WORD, DWORD</b> : donn√©es binaires, largeur fixe (1, 8, 16, 32 bits).  
        On peut d√©finir des masques ou plages de bits.  

        </p>

        <h3>Type de table / structure</h3>
        <p>
        <b>Structured Data</b> : regroupement de plusieurs variables. (>> : donn√©es de capteur, param√®tre d'un equipement... --> donn√©e complexe !) <br>
        Exemple : 
        <pre>
        TYPE Point
        STRUCT 
            x : REAL;
            y : REAL;
            z : REAL;
        END_STRUCT
        END_TYPE
        </pre>

        <b>Enumerated Data</b> : ensemble fini de valeurs symboliques.  (>> : Etat d'un syst√®me √† √©tat EXCLUSIF, √©tape de sequance...) <br>
        Parfait pour utiliser CASE <br>
        Exemple : 
        <pre>
        TYPE EtatMachine :
        (
            Arret,
            Demarrage,
            Production,
            Defaut
        );
        END_TYPE
        </pre>

        <b>Subrange</b> : plage de valeurs pour une variable.  
        Exemple :
        <pre>
        VAR vitesse : INT(0..100);
        END_VAR
        </pre>

        <b>Array</b> : tableau de variables du m√™me type avec index limit√©.  
        Exemple :
        <pre>
        VAR tabTemperature : ARRAY[1..10] OF REAL;
        END_VAR
        </pre>
        </p>

        <h3>Type de variables</h3>
        <p>
        - <b>Global</b> : accessible par tous les blocs du programme  <br>
        - <b>Input</b> : reli√©e √† une entr√©e physique ou logique  <br>
        - <b>Output</b> : reli√©e √† une sortie physique ou logique  <br>
        - <b>In_Out </b> : reli√©e √† une variable pass√©e en param√®tre <br>
        - <b>Retain</b> : m√©morise sa valeur apr√®s coupure d‚Äôalimentation  <br>
        - <b>Local</b> : limit√©e au bloc ou fonction dans lequel elle est d√©clar√©e<br>
        </p>


        <p>
          Dans la pluspart des logiciels ces variable sont d√©finie en texte comme 
          plus haut, cependant ce n'est pas le cas partout. Par Exemple sur Tia Portal 
          toute les variables sont d√©finie dans un fenetre propre
        </p>

        <hr>

        <h1>Organisation</h1>

        <h3>Fonctions internes</h3>

        <p>
        Les fonctions internes du langage ST (Structured Text) permettent de r√©aliser des calculs math√©matiques, logiques, temps, conversion de types, etc.  
        Voici les principales :  
        <ul>
            <li>Math√©matiques : <br><b>SIN(x), COS(x), TAN(x), ASIN(x), ACOS(x), ATAN(x), SQRT(x), EXP(x), LN(x), LOG(x), ABS(x), MOD(a,b), POWER(a,b),...</b></li>
            <li>Conversion de types :<br> <b>TO_INT(x), TO_REAL(x), TO_STRING(x), TO_BOOL(x)</b></li>
            <li>Logique : <br><b>AND, OR, NOT, XOR</b></li>
            <li>Temps / date :<br> <b>TOD(), DATE(), DT(), TIME(), ADD_TIME(t1,t2), SUB_TIME(t1,t2)</b></li>
            <li>Autres :<br> <b>LIMIT(x,MIN,MAX)</b>,...</li>
        </ul>
        </p>

        <h3>D√©finir une fonction ou bloc de function</h3>
        <p>
        <b>Function Block (FB)</b> : bloc avec √©tat interne (c√†d des variables locales, celles definit dans VAR, qui conservent leur valeur entre deux appels du FB) et interface d‚Äôentr√©es/sorties d√©finie.  Un 
        bloc de fonction peut appeler une fonction mais pas l'inverse.
        Cela permet de r√©utiliser du code et de simplifier la logique interne du FB
        </p>
        <pre>
        FUNCTION_BLOCK PID_LEVEL_CONTROL
        VAR_INPUT
        	TANK_LEVEL: REAL;
        	KP: REAL;
        	KI: REAL;
        	KD: REAL;
        END_VAR
        VAR_OUTPUT
            NEW_LEVEL : REAL;
        END_VAR
        VAR CONSTANT
            D_T : REAL := 0.05;   // 50 ms --> on peut modifier la valeur de temps de cycle dans la task
        END_VAR
        VAR
        	OBJECTIF: REAL:= 7; // plus pro de le mettre en apelle de la fonction mais bon 
        	ERREUR: REAL;
        	SUM_ERREUR: REAL:= 0;
        	PREV_ERREUR: REAL:=0; 
        	
        END_VAR

          ----------

        ERREUR := OBJECTIF - TANK_LEVEL;
        SUM_ERREUR:= SUM_ERREUR + ERREUR*D_T;
        
        NEW_LEVEL:= KP*ERREUR + KI*SUM_ERREUR + KD*((ERREUR-PREV_ERREUR)/D_T);
        
        PREV_ERREUR:= ERREUR;
        
        IF NEW_LEVEL > 10.0 THEN	// pour eviter les overshoot de l'output
            NEW_LEVEL := 10.0;
        ELSIF NEW_LEVEL < -10.0 THEN
            NEW_LEVEL := -10.0;
        END_IF;
          
        </pre>
        
        <p>
          Pour apeller cette fonction on ferait :
        </p>
     
        <pre>
            fbPID(     // on doit declarer fbPID : PID_LEVEL_CONTROL; dans les variables avant
            TANK_LEVEL := LEVEL_METER,
            KP := 20.0,
            KI := 0.1, 
            KD := 0.01
        	);
        	
        	VAL_PID := fbPID.NEW_LEVEL; // on √©crit .output --> ici le output est NEW_LEVEL donc 
        </pre>

        <p>
        <b>Function</b> : fonction de calcul pure sans √©tat interne.  
        </p>
        <pre>
        FUNCTION Square : REAL
        VAR_INPUT
            x : REAL;
        END_VAR

        ------

        Square := x * x;
          
        </pre>

        <p>
          Pour apeller cette fonction on ferait :
        </p>
     
        <pre>
            y := Square(x := 5.0);
        </pre>


        <h3>Boucles et structures de contr√¥le basique</h3>
  
        <pre>
        IF vitesse > 100 THEN
            vitesse := 100;
        ELSIF vitesse < 0 THEN
            vitesse := 0;
        END_IF

        CASE etat OF
            Arret:
              Moteur := FALSE;
              Alarme := FALSE;
      
            Demarrage:
              Moteur := TRUE;
              Alarme := FALSE;
      
          Production:
              Moteur := TRUE;
              // logique de production ici
      
          Defaut:
              Moteur := FALSE;
              Alarme := TRUE;
          ELSE
            Etat := Defaut;
          END_CASE

        FOR i := 1 TO 10 DO
            somme := somme + tab[i]; // avec un array 
        END_FOR

        WHILE capteur = TRUE DO   // Attention avec While >> bloque le cycle PLC
            compteur := compteur + 1;
        END_WHILE

        </pre>

        On utilise EXIT pour sortir d'une boucle ou RETURN si on est dans un fonction.

        <h3>Organisation d'un programme</h3>
        <p>
        Ordre recommand√© pour structurer un programme ST :  
        <ul>
            <li><b>Interface</b> : d√©claration des variables globales et locales</li>
            <li><b>Function / Function Block</b> : blocs logiques avec interface et √©tat interne</li>
            <li><b>Implementation</b> : corps principal du programme avec appels aux fonctions et FB</li>
        </ul>
        Exemple :
        </p>
        <pre>
        PROGRAM MAIN
        VAR
            moteur1 : FB_Moteur;
            vitesse : INT;
            startBtn : BOOL;
            stopBtn  : BOOL;
        END_VAR

        // Appel du function block --> bien nommer chaque variable avec son nom dans prgm original
        moteur1(start := startBtn, stop := stopBtn);

        // Calcul de vitesse limit√©e
        vitesse := LIMIT(vitesse, 0, 100);
        END_PROGRAM
        </pre>

  


    </main>
</div>

  <footer>
    ¬© 2025 - Guillaume Dengreville
  </footer>

</body>

</html>



